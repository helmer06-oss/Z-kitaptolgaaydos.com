<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Z-Kitap: Final | Tolga Aydos</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f1115;
            --panel-bg: #161b22;
            --neon-cyan: #00f2ff;
            --neon-green: #00e676;
            --neon-red: #ff3b30;
            --brand-orange: #ff9f43;
            --text-gray: #7f8c8d;
            --border-line: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: white;
            height: 100vh; height: 100dvh;
            width: 100vw;
            display: flex; flex-direction: column;
            overflow: hidden; user-select: none;
        }

        /* HEADER */
        header {
            height: 60px;
            background: var(--panel-bg);
            border-bottom: 1px solid var(--border-line);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            z-index: 50; flex-shrink: 0;
        }
        .logo {
            font-family: 'Orbitron', sans-serif; font-weight: 700; font-size: 1rem;
            color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 50%;
        }
        .logo span { color: var(--brand-orange); } 
        .logo .desc { font-weight: 400; color: #ccc; font-size: 0.8em; margin-left: 5px; }

        .toolbar { display: flex; gap: 5px; }
        .toolbar button {
            background: rgba(255,255,255,0.05); border: 1px solid var(--border-line);
            color: #ccc; width: 38px; height: 38px; border-radius: 6px;
            cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center;
        }
        .toolbar button.active-tool {
            background: var(--brand-orange); color: #000; border-color: var(--brand-orange);
        }
        #btn-finish { color: var(--neon-green); border-color: rgba(0, 230, 118, 0.3); }

        /* ANA KONTEYNER */
        .main-container {
            display: flex; flex: 1; padding: 20px; gap: 20px;
            height: calc(100vh - 60px); 
            overflow: hidden; 
        }

        /* SOL MEN√ú */
        .sidebar {
            width: 75px; height: 100%; 
            display: flex; flex-direction: column; gap: 10px;
            overflow-y: auto; padding-right: 5px; flex-shrink: 0;
            padding-bottom: 50px;
        }
        .sidebar::-webkit-scrollbar { width: 5px; }
        .sidebar::-webkit-scrollbar-track { background: #161b22; border-radius: 3px; }
        .sidebar::-webkit-scrollbar-thumb { background: var(--brand-orange); border-radius: 3px; }

        .q-nav-btn {
            width: 55px; height: 55px; margin: 0 auto;
            background: #1e222b; border: 1px solid var(--border-line);
            border-radius: 12px; color: var(--text-gray);
            font-family: 'Orbitron', sans-serif; font-weight: 600; font-size: 1.1rem;
            cursor: pointer; flex-shrink: 0; display: flex; align-items: center; justify-content: center;
            transition: 0.2s; position: relative;
        }
        .q-nav-btn.active {
            background: var(--brand-orange); color: #000;
            border-color: var(--brand-orange); transform: scale(1.05);
            box-shadow: 0 0 12px rgba(255, 159, 67, 0.4);
        }
        .q-nav-btn.answered::after {
            content: ''; position: absolute; bottom: 5px; right: 5px;
            width: 8px; height: 8px; background: var(--neon-cyan); border-radius: 50%;
        }

        /* ORTA ALAN */
        .stage-wrapper {
            flex: 1; background: #fff; border-radius: 15px;
            position: relative; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 30px rgba(0,0,0,0.5); overflow: hidden;
            min-height: 0;
        }
        .image-container { position: relative; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
        .image-container img { max-width: 100%; max-height: 100%; object-fit: contain; z-index: 1; opacity: 0; transition: opacity 0.2s; }
        #draw-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none; }
        
        .no-question-msg {
            position: absolute; color: #333; font-size: 1.2rem; text-align: center;
            display: none;
        }

        .nav-arrow {
            position: absolute; top: 50%; transform: translateY(-50%);
            width: 45px; height: 45px; border-radius: 50%;
            background: rgba(240, 240, 240, 0.9); border: 1px solid #ccc;
            color: #333; font-size: 1.4rem; cursor: pointer; z-index: 10;
            display: flex; align-items: center; justify-content: center;
        }
        .prev { left: 15px; } .next { right: 15px; }

        /* SAƒû PANEL */
        .right-panel {
            width: 320px; background: var(--panel-bg); border-radius: 20px;
            padding: 20px; display: flex; flex-direction: column; justify-content: space-between;
            box-shadow: -5px 0 20px rgba(0,0,0,0.2); flex-shrink: 0; overflow: hidden; 
        }
        .panel-header { text-align: center; margin-bottom: 5px; flex-shrink: 0; }
        .panel-header h2 {
            font-family: 'Orbitron', sans-serif; color: var(--neon-cyan); margin: 0; font-size: 1.8rem;
        }
        .counter { font-size: 0.9rem; color: #aaa; margin-left: 10px; background: rgba(255,255,255,0.1); padding: 2px 8px; border-radius: 6px; }
        
        .timer-display {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem; color: #ffeb3b;
            background: rgba(0,0,0,0.3); padding: 5px 15px;
            border-radius: 8px; margin-top: 5px; display: inline-block;
            border: 1px solid rgba(255, 235, 59, 0.2);
        }

        .options-grid { 
            display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr;
            gap: 12px; flex: 1; margin: 10px 0; min-height: 0;
        }
        
        .option-btn {
            width: 100%; height: 100%;
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.15);
            border-radius: 12px; color: #eee; font-family: 'Orbitron', sans-serif; 
            font-size: 2.2rem; cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; justify-content: center;
        }
        .option-btn:hover { background: rgba(255,255,255,0.06); }
        .option-btn.correct { border-color: var(--neon-green); color: var(--neon-green); background: rgba(0, 230, 118, 0.1); box-shadow: 0 0 15px rgba(0, 230, 118, 0.3); }
        .option-btn.wrong { border-color: var(--neon-red); color: var(--neon-red); background: rgba(255, 59, 48, 0.1); box-shadow: 0 0 15px rgba(255, 59, 48, 0.3); }
        
        /* YENƒ∞ SONRAKƒ∞ BUTONU */
        .next-btn-wide {
            width: 100%; padding: 12px; margin-bottom: 10px;
            background: var(--brand-orange); color: #161b22;
            border: none; border-radius: 10px;
            font-family: 'Orbitron', sans-serif; font-weight: 700; font-size: 1rem;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;
            transition: transform 0.1s;
        }
        .next-btn-wide:active { transform: scale(0.98); }

        .signature { text-align: center; font-size: 0.75rem; color: #666; flex-shrink: 0; }
        .signature b { color: var(--brand-orange); } 

        /* SONU√á MODALI */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);
            z-index: 100; display: none; align-items: center; justify-content: center;
        }
        .modal-content {
            background: #1e222b; border: 2px solid var(--neon-cyan);
            border-radius: 20px; padding: 30px; text-align: center;
            width: 90%; max-width: 400px;
            box-shadow: 0 0 30px rgba(0, 242, 255, 0.2);
            font-family: 'Orbitron', sans-serif;
        }
        .modal-content h2 { color: white; margin-top: 0; font-size: 2rem; }
        .stat-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;
        }
        .stat-box {
            background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;
        }
        .stat-val { font-size: 1.5rem; font-weight: bold; display: block; }
        .stat-label { font-size: 0.8rem; color: #aaa; }
        .stat-green { color: var(--neon-green); }
        .stat-red { color: var(--neon-red); }
        
        .modal-btn {
            background: var(--brand-orange); color: black; border: none;
            padding: 12px 30px; font-size: 1.1rem; border-radius: 8px;
            font-weight: bold; cursor: pointer; margin-top: 10px; font-family: 'Inter', sans-serif;
        }

        /* MOBƒ∞L UYUMLULUK */
        @media (max-width: 900px) {
            .main-container { 
                flex-direction: column; padding: 10px; gap: 10px;
                height: calc(100vh - 60px); 
            }
            .sidebar { 
                width: 100%; height: 60px; flex-direction: row; 
                overflow-x: auto; overflow-y: hidden;
                padding: 5px; border: none; background: transparent;
                flex-shrink: 0; margin: 0; gap: 8px;
            }
            .q-nav-btn { width: 45px; height: 45px; margin: 0; font-size: 0.9rem; }
            .stage-wrapper { flex: 1; min-height: 0; margin: 0; border-radius: 10px; }
            .nav-arrow { width: 35px; height: 35px; font-size: 1rem; opacity: 0.7; }
            .right-panel { 
                width: 100%; height: auto; padding: 10px; padding-bottom: 20px; 
                flex-shrink: 0; background: var(--panel-bg);
            }
            .panel-header { 
                display: flex; justify-content: space-between; align-items: center; margin-bottom: 0;
            }
            .panel-header h2 { font-size: 1.2rem; margin: 0; }
            .timer-display { margin: 0; font-size: 1rem; padding: 3px 8px; }

            .options-grid { margin: 8px 0; gap: 8px; height: 110px; flex: none; } 
            .option-btn { font-size: 1.5rem; }
            .logo .desc { display: none; }
            .signature { font-size: 0.65rem; margin-top: 5px; }
            
            /* Mobil i√ßin buton ayarƒ± */
            .next-btn-wide { padding: 10px; font-size: 0.9rem; margin-bottom: 5px; }
        }
    </style>
</head>
<body>

    <header>
        <div class="logo">tolga<span>aydos</span>.com <span class="desc">Fen Bilimleri Platformu</span></div>
        <div class="toolbar">
            <button id="btn-finish" onclick="finishTest()" title="Testi Bitir">üèÅ</button>
            <button id="btn-draw" onclick="toggleDrawing()" title="Kalem">‚úé</button>
            <button id="btn-erase" onclick="clearCanvas()" title="Temizle">‚å´</button>
            <button onclick="toggleFS()" title="Tam Ekran">‚õ∂</button>
        </div>
    </header>

    <div class="main-container">
        
        <div class="sidebar" id="sidebar"></div>

        <div class="stage-wrapper" id="stage">
            <button class="nav-arrow prev" onclick="changeQ(-1)">‚ùÆ</button>
            <div class="image-container">
                <img id="q-img" src="" alt="Soru">
                <div class="no-question-msg" id="no-q-msg">Soru Y√ºklenmedi<br><span style="font-size:0.8rem; color:#999">(Dosya Bulunamadƒ±)</span></div>
                <canvas id="draw-canvas"></canvas>
            </div>
            <button class="nav-arrow next" onclick="changeQ(1)">‚ùØ</button>
        </div>

        <div class="right-panel">
            <div class="panel-header">
                <h2>SORU <span id="q-idx">01</span> <span class="counter" id="q-total">/ 20</span></h2>
                <div class="timer-display" id="timer">00:00</div>
            </div>
            
            <div class="options-grid">
                <button class="option-btn" onclick="check(this, 'A')">A</button>
                <button class="option-btn" onclick="check(this, 'B')">B</button>
                <button class="option-btn" onclick="check(this, 'C')">C</button>
                <button class="option-btn" onclick="check(this, 'D')">D</button>
            </div>

            <button class="next-btn-wide" onclick="changeQ(1)">SONRAKƒ∞ ‚ùØ</button>
            
            <div class="signature">Designed by <b>tolgaaydos.com</b></div>
        </div>
    </div>

    <div class="modal-overlay" id="result-modal">
        <div class="modal-content">
            <h2>TEST Bƒ∞TTƒ∞</h2>
            <div class="stat-grid">
                <div class="stat-box">
                    <span class="stat-val stat-green" id="res-correct">0</span>
                    <span class="stat-label">Doƒüru</span>
                </div>
                <div class="stat-box">
                    <span class="stat-val stat-red" id="res-wrong">0</span>
                    <span class="stat-label">Yanlƒ±≈ü</span>
                </div>
                <div class="stat-box">
                    <span class="stat-val" style="color:#fff" id="res-empty">0</span>
                    <span class="stat-label">Bo≈ü</span>
                </div>
                <div class="stat-box">
                    <span class="stat-val" style="color:#ffeb3b" id="res-time">00:00</span>
                    <span class="stat-label">S√ºre</span>
                </div>
            </div>
            <button class="modal-btn" onclick="closeModal()">KAPAT</button>
        </div>
    </div>

    <script>
        // ============================================
        // AYARLAR
        // ============================================
        const TOTAL_QUESTIONS_LIMIT = 20; 
        
        // ============================================
        // DEƒûƒ∞≈ûKENLER
        // ============================================
        let current = 0;
        let isDrawingMode = false;
        let isDrawing = false;
        const canvas = document.getElementById('draw-canvas');
        const ctx = canvas.getContext('2d');
        let lastX = 0, lastY = 0;

        let questionCache = new Array(TOTAL_QUESTIONS_LIMIT).fill(null); 
        let userAnswers = {}; 
        let timerInterval;
        let seconds = 0;

        function init() {
            setupCanvas();
            window.addEventListener('resize', resizeCanvas);
            renderSidebar(); // Anƒ±nda y√ºkle
            load(0);
            startTimer();
        }

        function renderSidebar() {
            const sb = document.getElementById('sidebar');
            sb.innerHTML = '';
            for(let i = 0; i < TOTAL_QUESTIONS_LIMIT; i++) {
                const btn = document.createElement('button');
                btn.className = 'q-nav-btn';
                btn.id = 'nav-btn-' + i; 
                btn.textContent = i + 1;
                btn.onclick = () => load(i);
                sb.appendChild(btn);
            }
        }

        async function load(idx) {
            if(idx < 0 || idx >= TOTAL_QUESTIONS_LIMIT) return;
            current = idx;
            
            clearCanvas();
            document.getElementById('q-idx').innerText = (idx + 1).toString().padStart(2, '0');
            
            const btns = document.querySelectorAll('.q-nav-btn');
            btns.forEach((b, i) => {
                const isActive = i === idx;
                b.classList.toggle('active', isActive);
                if(isActive) b.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
            });

            const img = document.getElementById('q-img');
            const msg = document.getElementById('no-q-msg');
            img.style.opacity = 0;
            msg.style.display = 'none';

            const fileName = await findQuestionFile(idx + 1);
            
            if(fileName) {
                img.src = fileName;
                img.onload = () => { img.style.opacity = 1; resizeCanvas(); };
            } else {
                img.src = ''; 
                msg.style.display = 'block';
            }

            resetBtns();
            restoreAnswerState();
        }

        async function findQuestionFile(qNum) {
            if(questionCache[qNum - 1] !== null) return questionCache[qNum - 1];

            const suffixes = ['A', 'B', 'C', 'D'];
            for (let char of suffixes) {
                const fName = `${qNum}${char}.jpg`;
                if(await imageExists(fName)) {
                    questionCache[qNum - 1] = fName;
                    return fName;
                }
            }
            questionCache[qNum - 1] = false;
            return false;
        }

        function imageExists(url) {
            return new Promise(resolve => {
                const img = new Image();
                img.onload = () => resolve(true);
                img.onerror = () => resolve(false);
                img.src = url;
            });
        }

        function changeQ(dir) { load(current + dir); }

        function setupCanvas() {
            canvas.addEventListener('mousedown', startD); canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopD); canvas.addEventListener('mouseout', stopD);
            canvas.addEventListener('touchstart', (e) => {
                const t = e.touches[0]; canvas.dispatchEvent(new MouseEvent('mousedown', { clientX: t.clientX, clientY: t.clientY }));
            });
            canvas.addEventListener('touchmove', (e) => {
                const t = e.touches[0]; canvas.dispatchEvent(new MouseEvent('mousemove', { clientX: t.clientX, clientY: t.clientY }));
            });
            canvas.addEventListener('touchend', () => canvas.dispatchEvent(new MouseEvent('mouseup', {})));
            resizeCanvas();
        }
        function resizeCanvas() {
            const container = document.querySelector('.image-container');
            if(container) {
                canvas.width = container.offsetWidth; canvas.height = container.offsetHeight;
                ctx.lineJoin = 'round'; ctx.lineCap = 'round'; ctx.lineWidth = 3; ctx.strokeStyle = '#e74c3c';
            }
        }
        function toggleDrawing() {
            isDrawingMode = !isDrawingMode;
            const btn = document.getElementById('btn-draw');
            const stage = document.getElementById('stage');
            if(isDrawingMode) {
                btn.classList.add('active-tool'); canvas.style.pointerEvents = 'auto'; stage.style.cursor = 'crosshair';
            } else {
                btn.classList.remove('active-tool'); canvas.style.pointerEvents = 'none'; stage.style.cursor = 'default';
            }
        }
        function startD(e) {
            if(!isDrawingMode) return; isDrawing = true;
            const rect = canvas.getBoundingClientRect(); lastX = e.clientX - rect.left; lastY = e.clientY - rect.top;
        }
        function draw(e) {
            if(!isDrawing || !isDrawingMode) return;
            const rect = canvas.getBoundingClientRect(); const x = e.clientX - rect.left; const y = e.clientY - rect.top;
            ctx.beginPath(); ctx.moveTo(lastX, lastY); ctx.lineTo(x, y); ctx.stroke(); [lastX, lastY] = [x, y];
        }
        function stopD() { isDrawing = false; }
        function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); }

        function resetBtns() {
            document.querySelectorAll('.option-btn').forEach(b => {
                b.className = 'option-btn'; b.style.pointerEvents = 'auto';
            });
        }

        function restoreAnswerState() {
            if(questionCache[current] === false) {
                 document.querySelectorAll('.option-btn').forEach(b => b.style.pointerEvents = 'none');
                 return;
            }
            if(userAnswers.hasOwnProperty(current)) {
                const fileName = questionCache[current];
                if(!fileName) return;
                const match = fileName.match(/(\d+)([A-D])/i);
                if(match) {
                    const correct = match[2].toUpperCase();
                    document.querySelectorAll('.option-btn').forEach(b => {
                        b.style.pointerEvents = 'none';
                        if(b.textContent === correct) b.classList.add('correct');
                    });
                }
            }
        }

        function check(btn, choice) {
            const fileName = questionCache[current];
            if(!fileName) return;

            const match = fileName.match(/(\d+)([A-D])/i);
            if(!match) return;
            const correct = match[2].toUpperCase();

            document.querySelectorAll('.option-btn').forEach(b => b.style.pointerEvents = 'none');

            let isCorrect = false;
            if(choice === correct) {
                btn.classList.add('correct');
                isCorrect = true;
            } else {
                btn.classList.add('wrong');
                document.querySelectorAll('.option-btn').forEach(b => {
                    if(b.textContent === correct) b.classList.add('correct');
                });
            }
            userAnswers[current] = isCorrect;
            document.getElementById('nav-btn-' + current).classList.add('answered');
        }

        function startTimer() {
            clearInterval(timerInterval);
            seconds = 0;
            timerInterval = setInterval(() => {
                seconds++;
                const m = Math.floor(seconds / 60).toString().padStart(2, '0');
                const s = (seconds % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${m}:${s}`;
            }, 1000);
        }
        function stopTimer() { clearInterval(timerInterval); }

        function finishTest() {
            stopTimer();
            let correctCount = 0;
            let wrongCount = 0;
            for(let i=0; i<TOTAL_QUESTIONS_LIMIT; i++) {
                if(questionCache[i] === false) continue; 
                if(userAnswers[i] === true) correctCount++;
                else if(userAnswers[i] === false) wrongCount++;
            }
            document.getElementById('res-correct').innerText = correctCount;
            document.getElementById('res-wrong').innerText = wrongCount;
            document.getElementById('res-empty').innerText = (TOTAL_QUESTIONS_LIMIT - correctCount - wrongCount); 
            document.getElementById('res-time').innerText = document.getElementById('timer').innerText;
            document.getElementById('result-modal').style.display = 'flex';
        }
        function closeModal() { document.getElementById('result-modal').style.display = 'none'; }
        function toggleFS() {
            if(!document.fullscreenElement) document.documentElement.requestFullscreen();
            else if(document.exitFullscreen) document.exitFullscreen();
        }

        init();
    </script>
</body>
</html>
